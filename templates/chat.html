{{ define "chat" }}

<div class="section p-3 fh">
  {{ if .addLoginButton }}
  <div hx-swap-oob="beforeend:#nav">
    <div id="logoutButton">
      <div class="button is-success" hx-post="/logout" hx-target="#main" hx-confirm="Are you sure?">LOGOUT</div>
    </div>
  </div>
  {{ end }}

  <div hx-ext="sse" sse-connect="/connect_chat" id="chatarea">
    <div class="topbox">
      <p class="is-flex-grow-1">Your name: '{{ .username }}'</p>

      <!-- SSE messages with type 'server' are picked up here -->
      <span sse-swap="server"></span>
    </div>

    <form hx-post="/chat" hx-swap="none" hx-on::after-request="this.reset()" hx-trigger="click from:#send,keyup[!shiftKey&&keyCode==13]">
      <input type="hidden" name="username" value="{{ .username }}" />

      <div class="is-flex">
        <div class="field is-flex-grow-1 mr-4">
          <label class="label">Message</label>
          <textarea
            class="textarea mr-3 is-rounded is-info has-fixed-size"
            rows="2"
            name="message"
            required
            placeholder="Say something"
          ></textarea>
        </div>
        <div class="field is-flex is-align-items-center">
          <input class="button is-info" type="button" value="Send ✉️" id="send" />
        </div>
      </div>
    </form>

    <!-- SSE messages with type 'chat' are picked up here -->
    <div id="chat" sse-swap="chat" hx-swap="beforeend" hx-on::after-settle="this.scrollTo(0, this.scrollHeight);"></div>
  </div>
</div>

{{ end }}
